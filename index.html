<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∏–ø–∏—á–Ω—ã–π –ü–µ—Ä–µ—Å–ª–∞–≤–ª—å ‚Äî –ù–æ–≤–æ—Å—Ç–∏ –∏ –¢–ì</title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #0f172a;
            --border: #e2e8f0;
        }

        .dark-theme {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --border: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; transition: 0.3s; }
        body { font-family: 'Manrope', sans-serif; background-color: var(--bg); color: var(--text); }

        header {
            background: var(--card);
            padding: 1rem 0;
            border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 1000;
        }

        .container { max-width: 1000px; margin: 0 auto; padding: 0 20px; }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; text-decoration: none; color: var(--text); }
        .logo span { color: var(--primary); }

        .section-title { margin: 30px 0 20px; font-size: 1.5rem; font-weight: 800; display: flex; align-items: center; gap: 10px; }

        /* –°–ï–¢–ö–ê –ù–û–í–û–°–¢–ï–ô –ò–ó –°–ú–ò */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .card {
            background: var(--card); border-radius: 16px; padding: 20px;
            text-decoration: none; color: inherit; border: 1px solid var(--border);
            transition: transform 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: var(--primary); }
        .card-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 10px; }

        /* –ë–õ–û–ö TELEGRAM */
        .tg-container {
            background: var(--card);
            border-radius: 20px;
            padding: 10px;
            border: 1px solid var(--border);
            margin-bottom: 40px;
            overflow: hidden;
            min-height: 400px;
        }

        .theme-btn { cursor: pointer; background: none; border: 1px solid var(--border); padding: 5px 10px; border-radius: 8px; color: var(--text); }

        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<header>
    <div class="container">
        <div class="header-content">
            <a href="#" class="logo">–¢–∏–ø–∏—á–Ω—ã–π <span>–ü–µ—Ä–µ—Å–ª–∞–≤–ª—å</span></a>
            <button class="theme-btn" id="theme-toggle">üåì –¢–µ–º–∞</button>
        </div>
    </div>
</header>

<div class="container">
    
    <h2 class="section-title">üì± –ú—ã –≤ Telegram</h2>
    <div class="tg-container">
        <script async src="https://telegram.org/js/telegram-widget.js?22" 
                data-telegram-discussion="TPereslavl" 
                data-comments-limit="5" 
                data-color="2563eb" 
                data-dark="1"></script>
        
        <iframe src="https://tg.i-c-a.su/media/TPereslavl/10" 
                width="100%" height="500" frameborder="0" 
                style="border-radius: 15px;"></iframe>
    </div>

    <h2 class="section-title">üì∞ –ù–æ–≤–æ—Å—Ç–∏ –æ–±–ª–∞—Å—Ç–∏</h2>
    <div id="news-grid" class="grid">
        <div style="padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</div>
    </div>

</div>

<script>
    // 1. –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê
    const themeToggle = document.getElementById('theme-toggle');
    if (themeToggle) {
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
        });
    }

    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-theme');
    }

    // 2. –ó–ê–ì–†–£–ó–ö–ê –ù–û–í–û–°–¢–ï–ô (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ú–ï–¢–û–î)
    async function loadNews() {
        const grid = document.getElementById('news-grid');
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä—É–≥–æ–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å GitHub Pages
        const RSS_URL = 'https://76.ru/text/rss.xml';
        const FETCH_URL = `https://api.allorigins.win/get?url=${encodeURIComponent(RSS_URL)}`;
        
        try {
            const response = await fetch(FETCH_URL);
            const data = await response.json();
            
            // –ü–∞—Ä—Å–∏–º XML –≤—Ä—É—á–Ω—É—é, —Ç–∞–∫ –∫–∞–∫ AllOrigins –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(data.contents, "text/xml");
            const items = xmlDoc.querySelectorAll("item");

            grid.innerHTML = '';

            items.forEach((item, index) => {
                if (index > 15) return; // –û–≥—Ä–∞–Ω–∏—á–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤–æ—Å—Ç–µ–π

                const title = item.querySelector("title").textContent;
                const link = item.querySelector("link").textContent;
                const description = item.querySelector("description").textContent
                    .replace(/<[^>]*>?/gm, '') // –û—á–∏—Å—Ç–∫–∞ –æ—Ç HTML-—Ç–µ–≥–æ–≤
                    .substring(0, 110);

                const isPereslavl = title.toLowerCase().includes('–ø–µ—Ä–µ—Å–ª–∞–≤–ª—å') || 
                                    description.toLowerCase().includes('–ø–µ—Ä–µ—Å–ª–∞–≤–ª—å');
                
                const card = document.createElement('a');
                card.href = link;
                card.target = '_blank';
                card.className = 'card';
                
                const tagText = isPereslavl ? "–í–ê–ñ–ù–û: –ü–ï–†–ï–°–õ–ê–í–õ–¨" : "–Ø—Ä–æ—Å–ª–∞–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å";

                card.innerHTML = `
                    <span class="card-tag" style="${isPereslavl ? 'color: #e63946;' : ''}">${tagText}</span>
                    <h2 class="card-title">${title}</h2>
                    <p class="card-desc">${description}...</p>
                    <div style="font-size: 0.9rem; font-weight: 700; color: var(--primary);">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</div>
                `;
                grid.appendChild(card);
            });
        } catch (error) {
            console.error(error);
            grid.innerHTML = '<div class="loader">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∑–∂–µ.</div>';
        }
    }

    loadNews();
</script>
